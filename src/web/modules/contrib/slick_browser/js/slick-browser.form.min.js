!function(p,v,o,m){"use strict";var b="entity_browser_select",e="is-sb",s="sb-form",u="form--sb--on",l=".form--sb:not(."+u+")",t="entities-list",a="sb-"+t,n=t+"--on",i="."+t+":not(."+n+")",C="#edit-selected",y="sbCounter",r=e+"-marked",w=e+"-checked",k="."+w,_=r+" "+w,d=e+"-empty",E=e+"-collapsed",B="was-sb-checked",$="checked",c="disabled",S="item-container",T="."+S,L="cardinality",j="form--overlimit",D="data-entity",A=D+"-id",I="img",P=".views-field--selection",R=".grid",U=".button--select";function g(t){var e,n,g=v.slickBrowser.form,s=p(t),o=s.closest("body"),l=p(m.parent.document),a=p(".ui-dialog:visible",l),i=p('input[name*="'+b+'"]',t),r=p('.button[name="use_selected"]',t),d=r.length?r.val():v.t("Add to Page"),c="#edit-use-selected-clone",h=p(C,t).removeClass("hidden"),f=s.data(L)||-1;g.$form=s,p(".sb__radios",t).length&&s.addClass("form--media-bundle-selection"),s.on("click.sbGrid",".grid:not(.view-list--header, ."+B+")",function(e){if(e.preventDefault(),!function(r){var d=p(r),e='input[name^="'+b+'"]',c=p(e,r),m=c.val(),u=m.split(":")[1],t=d.closest(".view--sb");function n(){var e,t,n,o,s,l,a,i;c.prop($,!c.prop($)).attr(A,u).attr(D,m),d[c.prop($)?"addClass":"removeClass"](_),p(U,r).html(c.prop($)?"&#10003;":"&#43;"),t=p(e=r),n=p('input[name^="'+b+'"]',e),o=n.val(),s=o.split(":")[1],l=p(I,e),a=p(".media",e).data("thumb"),i=p(P,e).length?p(P,e):p(".views-field:nth-child(2)",e),e=null,g.noLongerEmpty(),t.attr(A,s).attr(D,o),a?e=p('<img src="'+a+'" alt="'+v.t("Thumbnail")+'">'):l.length?e=l:i.length&&(e=i),null!==e&&h.length&&((e=e.clone()).closest(T).length||e.addClass("item-selected").detach().appendTo(h).wrapAll('<div class="'+S+'" '+A+'="'+s+'" '+D+'="'+o+'" />'),p(T,h).each(function(e){var t=p(this);p(".weight",t).length||(t.append('<span class="button-wrap button-wrap--remove"><input value="Remove" class="button button--remove button--remove-js" type="button"></span>'),t.append('<input class="weight" value="" type="hidden" />'),p(".button--remove",t).attr(A,s).attr(D,o).attr("data-remove-entity","items_"+o).attr("name","remove_"+s+"_"+e),p(".weight",t).val(e).attr("name","selected[items_"+s+"_"+e+"][weight]").attr("data-drupal-selector","edit-selected-items-"+s+"-"+e+"-weight"))}),n.prop($)||h.find(T+"["+A+'="'+s+'"]').remove())}switch(g.noLongerEmpty(),f){case 1:if(t.find("."+B).length)return s.addClass(j);s.removeClass(j),function(){p(e).not(d.find("input")).prop($,!1),t.find(R).not(this).removeClass(_)}(),n(),h.length&&h.find(".item-container:not(["+A+'="'+u+'"])').remove();break;case-1:n();break;default:var o=t.find(k).length;if(h.length&&h.children().length&&(o=h.children().length),s[o===f?"addClass":"removeClass"](j),f<=o)return d.hasClass(w)?(c.prop($,!1),d.removeClass(_),p(U,r).html("&#43;"),h.length&&h.find(T+"["+A+'="'+u+'"]').remove(),s.removeClass(j)):s.addClass(j);n()}}(e.currentTarget),!h.length)return s.addClass(E),!1;h.trigger("change."+y),p(".button-wrap--show-selection",t).show(),s.removeClass(E)}),s.on("click.sbRemove",".button--remove-js",function(e){e.preventDefault();var t=p(e.currentTarget).closest(T),n=t.data("entity"),e=s.find('input[name="'+b+"["+n+']"]');(n=s.find(".is-sb-marked["+D+'="'+n+'"]')).removeClass(_),e.prop($,!1).closest(k).removeClass(_),t.remove(),s.removeClass(j),p(U,n).html("&#43;"),h.length&&h.trigger("change."+y),g.isEmpty()&&g.doEmpty()}),s.on("click.sbShow",".entity-browser-show-selection",function(){s.toggleClass(E)}),s.on("click.sbUpload",".js-form-file, .dz-clickable",g.onUpload.bind(g)),s.on("click.sbInsert","#edit-use-selected",v.slickBrowser.loading),s.on("click.sbSubmit","#edit-submit",v.slickBrowser.loading),o.on("click.sbMessage",".messages",function(e){p(e.target).remove()}),o.addClass("sb-body"),p("> div:not(.sb__aside)",t).addClass("sb__main"),g.isEmpty()?(g.doEmpty(),a.length&&a.find(c).remove()):(a.length&&(e=p('<button id="edit-use-selected-clone" class="button button--primary button--sb button--use-selected-clone">'+d+"</button>"),n=a.eq(0).find(".ui-dialog-titlebar-close"),r.length&&!a.find(c).length&&e.insertBefore(n),a.on("click.sbDialogInsert",c,function(e){p(e.delegateTarget).addClass("is-b-loading"),r.click()})),p(c).text(d).removeClass("visually-hidden"),i.length&&g.noLongerEmpty()),s.addClass(u)}function h(e){var s=v.slickBrowser.form,l=p(e),e=l.closest("form"),a=e.data("targetType");s.$form=e,l.children().each(function(e,t){var n=p(t).data("entityId"),t=p("input",t),o=a+":"+n;s.toggleSelected(o,!1),t.on("mousedown",function(){s.toggleSelected(o,!0),m.setTimeout(function(){l.trigger("change."+y)},300)})});e=function(){s.toggleCounter()};e(),l.on("change."+y,e),l.addClass(n)}v.slickBrowser=v.slickBrowser||{},v.slickBrowser.form=v.slickBrowser.form||{$form:null,isEmpty:function(){return!p(C,this.$form).children().length},doEmpty:function(){this.$form.addClass(d+" "+E)},noLongerEmpty:function(){this.$form.removeClass(d)},onUpload:function(){this.noLongerEmpty()},toggleCounter:function(){var e,t=this,n=t.$form.data(L)||-1,o=p(C,t.$form),s=p("#edit-counter",t.$form);o.length&&(e=o.children().length,o=-1===n?"unlimited":n,n=v.formatPlural(e,"1","@count"),n+=" "+v.formatPlural(o,"of 1 item selected","of @count items selected"),t.$form.hasClass(j)&&(n+=" "+v.t("(Remove one to select another)")),s.text(0<e?n:""),t.isEmpty()&&t.doEmpty())},toggleSelected:function(e,t){var n=p('input[name="'+b+"["+e+']"]'),o=t?"":v.t("Was selected");n.length&&(e=n.closest(R),t?(n.prop($,!1).removeAttr(c),e.removeClass(_+" "+B)):(n.prop($,!0).attr(c,c),e.addClass(r+" "+B)),(e.find(I).length?e.find(I):e).attr("title",o))}},v.behaviors.slickBrowserForm={attach:function(e){o.once(g,s,l,e),o.once(h,a,i,e)},detach:function(e,t,n){"unload"===n&&(o.once.removeSafely(s,l,e),o.once.removeSafely(a,i,e))}}}(jQuery,Drupal,dBlazy,this);
