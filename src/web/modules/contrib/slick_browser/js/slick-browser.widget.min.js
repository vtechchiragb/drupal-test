!function(m,v,t,s){"use strict";var e="is-sb",a=".sb",i="sb-widget",p="sb--widget--on",_=a+"--widget",r=a+"--widget:not(."+p+")",l="sb-sortable",o="sb__sortable--on",n=a+"__sortable:not(."+o+")",w="data-slick-index",y="slick-initialized",C=".slick-cloned",x=e+"-active",B=e+"-focused",d=".js-form-managed-file .js-form-submit:not(.button--sb)",c="sbAjax";function b(d){var c=m(d),s=c.closest("form"),b=c.attr("id"),e=m(".slick__slider",d),g=m(".slick--browser .slick__slider",d),t=m(".sb__header",d),a=m(".slick-dots",d),i=m(".blazy--grid",d),r=m(".blazy",d),l=c.data("end")?c.data("end"):0,o=g.hasClass(y);function k(){o&&(e.find(C).removeAttr("data-entity-id data-row-id data-drupal-selector"),e.on("setPosition",function(){e.find(C).removeAttr("data-entity-id data-row-id data-drupal-selector")}))}function u(){var e;a.length&&(e=a.height(),c.height()-80<=e&&c.css("minHeight",e+80)),i.length&&(r.length&&v.attachBehaviors(r[0]),g.length&&g[0].slick.refresh())}function h(l){m(".slick",d).length&&m(".slick",d).each(function(){var e,t=m(".slick__slider",this),a=m(".slide",t),s=t.slick("getSlick"),i=0,r=!1;l?"removeall"===l.data("target")?(t.slick("removeSlide",null,null,!0),r=!0):(e=l.closest(".slide").data("slickIndex"),t.slick("slickRemove",e),a.each(function(){m(this).attr(w,i),i++}),1===a.length&&(c.empty(),r=!0)):(a.sort(function(e,t){return m(e).data("rowId")-m(t).data("rowId")}),t.empty(),a.clone().detach().appendTo(t),t.slick(s.options),r=!0),r&&(v.attachBehaviors(c[0]),m(".media--player",a).length&&v.attachBehaviors(m(".media--player",a)[0]))})}function n(e){var t=s.length?s[0]:e.delegateTarget,e=m(".is-sb-error",t).attr("id"),a=m(".sb .slick__slider",t),t=m(".form-text.required",t);t.length&&(m(".slick-cloned .form-text",a).removeAttr("required aria-required"),t.each(function(){var e,t=m(this);t.removeClass("error").removeAttr("tabindex"),this.value||(e=parseInt(t.closest(".slide").data("slickIndex"),0),t.addClass("error"),t.closest(_).addClass("is-sb-error is-sb-caption"),a.length&&(a.slick("slickGoTo",e,!0),a.slick("slickPause")))}),v.slickBrowser.jump(e))}m(".media-library-item--grid",d).removeClass("media-library-item--grid"),k(),c.hasClass("is-sb-1")&&m(".slick__slide",d).addClass("slick-current slick-active"),o&&!t.find(".slick__arrow").length&&g.siblings(".slick__arrow").appendTo(t),1<l&&m(".focal-point-indicator",g).length&&(m("*[draggable!=true]",g).unbind("dragstart"),g.on("draggable mouseenter mousedown",".focal-point-indicator",function(e){e.stopPropagation()})),c.data("deltas","");var f="click.btnSb",t="click.altSb",l="blur.altSb";c.off(f).on(f,".button--sb",function(e){e.preventDefault();var t=m(e.currentTarget),a=t.data("handled"),s=t.data("target"),i=c.siblings('input[type*=hidden][name*="[target_id]"]');function r(){var e=c.find("input[data-entity-id]").length;c.attr("data-sb-count-items",e)}switch("done"!==s&&c.data("deltas",""),c.toggleClass("is-sb-"+s),m.each(["caption","crop","sort","done"],function(e,t){"done"!==s&&s===t||c.removeClass("is-sb-"+t)}),m(".button--sb").removeClass(x),m(".button--"+s,d)[c.hasClass("is-sb-"+s)?"addClass":"removeClass"](x),r(),s){case"crop":!a&&g.length&&g[0].slick.refresh();break;case"remove":var l=t.data("entityId")||t.closest("[data-entity-id]").data("entityId"),o=i.val(),n=c.data("removedId")||"";i.val(m.trim(o.replace(l,""))),c.data("removedId",n+" "+l),h(t),c.find('.sb__sortable [data-entity-id="'+l+'"]').remove(),r();break;case"removeall":i.val(""),c.contents(':not(div[id*="ajax-wrapper"])').remove(),c.css("minHeight",0),h(t),r();break;case"done":c.data("deltas")&&h(),g.length&&(m(".slick-prev:not(.slick-disabled)",g).length?m(".slick-prev:not(.slick-disabled)",g).trigger("click"):m(".slick-next:not(.slick-disabled)",g).length?m(".slick-next:not(.slick-disabled)",g).trigger("click"):g[0].slick.refresh()),r()}t.data("handled",!a),v.slickBrowser.jump(b),k(),u()}),c.off(t).on(t,".js-form-type-textfield input",function(e){m(e.target).parent().addClass(B)}),c.off(l).on(l,".js-form-type-textfield input",function(e){m(e.target).parent().removeClass(B)}),n(),s.on("click.btnDo","#edit-submit",n),u(),c.addClass(p)}function g(c){var e=m(c);t.create(c,{draggable:".sb__sortitem",onEnd:function(e){var t,a,e=m(e.item),s=m(".sb__sortitem",c),i=e.closest(_),r=e.closest(".is-sb-eb").length,l=[],o=[],n=s.length;m(".slick",i).each(function(){var e=m(".slick__slider",this);e.hasClass(y)&&e.slick("unslick")}),i.find(".slick__slide.slick-cloned").remove();for(var d=0;d<n;d++)a=s[d],t=m(a).data("rowId"),o[d]=t,m(".sb__weight",a).val(d),m(".sb__weight option",a).removeAttr("selected"),m('.sb__weight option[value="'+d+'"]',a).prop("selected",!0).siblings("option").prop("selected",!1),i.find(".slick__slide.slide--"+t).attr(w,d).attr("data-row-id",d),m(a).attr("data-row-id",d),r&&(l[d]=m(a).attr("data-entity-id"));i.data("deltas",o),r&&i.siblings('input[type*=hidden][name*="[target_id]"]').val(l.join(" "))}}),e.addClass(o)}v.slickBrowser=v.slickBrowser||{},v.behaviors.slickBrowserWidget={attach:function(e){var t=v.slickBrowser;s.once(b,i,r,e),s.once(g,l,n,e),m(d,e).on("mousedown."+c,t.loading)},detach:function(e,t,a){"unload"===a&&(m(d,e).off("."+c),s.once.removeSafely(i,r,e),s.once.removeSafely(l,n,e),v.slickBrowser.loaded())}}}(jQuery,Drupal,Sortable,dBlazy);
